# double_mysql

**DNF存档备份教程：服务端单库改双库**

**目录**

[前言](#jump1)

[使用工具](#jump2)

[一、备份存档](#jump3)

[二、更改IP指向](#jump4)

[三、告知服务器](#jump5)

[四、快速备份存档](#jump6)

[五、快速瘦身](#jump7)

[六、后记](#jump8)

------

<span id="jump1">**前言**</span>

你是一个萌新，一个不堪企鹅压榨，为了自给自足，努力好学的萌新。

你搭建了DNF服务器，折腾了好几天，终于玩上了DNF单机版。

但是随后你可能发现，服务端越来越膨胀，硬盘吃紧了；

或者有几次断电重启，数据库出错了；

又或者你想把豪华装备的角色带到公司/学校，享受小伙伴们的惊叹眼神，但苦于找不到存档；

那么，你就得看这篇文章了。

你的问题在于，

DNF是网游，并没有普遍意义上的“存档”。你必须以数据库的形式导出你的角色。

通常你可以选择备份整个mysql文件夹，但它太大了（至少1个g），用ftp工具下载传输非常非常的慢；而且你会发现有一些文件无法复制出来，总之问题多多。

这篇文章就是指导你如何备份存档。

操作原理还是有点复杂的，但一旦学会之后，两三个步骤就能备份好你的角色。

可既然你都学这么多了，为什么不顺路把数据库改成双库呢？这样换版本的时候，5分钟就能轻松完成工作。

妈妈再也不怕我的硬盘爆数据了。

本文并非从零开始的教程，需要你有一定基础——至少你得成功搭建过一个自己的DNF服务器吧？

如果你真的是一点都不会的萌新，建议你去“台服黑岩pvf吧”，精品帖，酸甜果汁大大出的视频教程。

<span id="jump2">**使用工具**</span>

- 一个可以运行的服务端，客户端（废话）

- VirtualBox（VMware也行，本文采用更省内存的VB）

- WinSCP

- phpStudy2018 （https://www.xp.cn/）

- Navicat for MySQL

- 一份干净的DNF数据库（后面有详述）

链接: https://pan.baidu.com/s/1fxvQa_b6o79g4_Wg5kYbFw 提取码: qd4j

<span id="jump3">**一，备份存档**</span>

通常我们的存档是以MySql数据库形式，和服务端一起存放的。

第一步我们先把这个存档导出来。

首先，把你的服务端跑起来，不需要全开，只要输入密码完毕就行了。

接下来用到的软件，Navicat for MySQL或者MySql-Front都可以。

前者可以批量备份——缺陷是若你的数据库中有错误，就会半途终止；后者则是手动导出。

这里以后者MySql-Front做例子，因为我的数据库就是因为断电坏了，无法自动备份。幸好角色没受损。

如果你想省事，用Navicat for MySQL快速备份，请直接去第四章。

MySql-Front是phpStudy2018集成的软件。安装phpStudy2018（不要乱放，选择一个大点的硬盘，这个文件夹后面有用）

启动位置如图：

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/5180B73A173841A9912AA102B319690C/180)

然后会让你选择登录地点，正常你这里是空的，我们新建，输入IP地址

（就是你搭建服务端的时候分配给虚拟机的IP地址，你不会忘了吧？这里以192.168.200.131为例，端口3306）

账号密码端口是默认的game，密码uu5!^%jg

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/E83C3E6F61EF497183FD8BF56DDCBC91/183)

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/0089363AA29C4EDDACFFF3A9A8CF2200/188)

成功打开之后，我们会在左面看到长长的一串。

这是数据库的儿子，我们叫它“表单”。

把每个儿子单独备份出去，右键，输出-Sql文件，选择一个文件夹 ，确认。

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/050F5534C5D24353ABA942B4095F4D51/210)

需要注意的是保存界面的字符集，有的儿子嘴刁啊，UTF-8的备份可能会提示出错，这就需要改成UNICODE。这种可能是因为文字问题，可能这个表单保存的是公告，或者含有韩文等等。

一般来说并不是每个儿子都值得保存的，不过多做无错，我的数据库正好公告坏了，死活导不出去，但角色顺利导出去就没问题了。

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/10CFB78D6B4A429B81475C448C85AFBA/212)

恭喜你，经过以上步骤存档就备份完了，我们需要在硬盘上给儿子找一个新家，安装一个新的mysql数据库。

前面说过，你不能直接把原来虚拟机里的mysql数据库复制出来，会有文件提示出错。

所以我百度了一下，找到一个文件，名叫做 台服DNF70版本【data】.rar

讲真，我都不知道这东西是做什么的；但既然它能用就行了。我会随后放出来发在网盘里，大家按需使用。

不过这个数据库有个后门，毕竟免费百度出来的东西就是不咋好用，不过你不开服这后门也没啥作用，怎么去除后面再说。

压缩包里是一个data文件夹，解压出来。

但不要随便放！

mysql是一个非常复杂的数据库，一般人玩不转。但前面你不是安装了phpstudy2018的软件了吗？

你走运了，这是一个让小白也能轻松搭建mysql数据库的软件。

记得关掉phpstudy2018，然后把data放到你的硬盘下

 \phpStudy\PHPTutorial\MySQL\

如图所示：

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/950B2A0FBBAB473D8D33F6F38243D433/235)

（小提示：如果你的机器很差，想优化服务端的内存占用，这里的my.ini、my-huge.ini等等都可以针对性的优化mysql的性能，具体的这里不教了，自己百度吧）

重新打开phpstudy2018

点击“启动”按钮，等到两个灯都绿了，恭喜你，你搭建好了自己的mysql数据库，很多老鸟都不一定会的一步！

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/43A2E550BFAE4D76A7E905312177DBE8/264)

记住，关闭游戏之后，**一定要记得点“停止”按钮**。如果你关了软件，但忘了点停止，数据库还是会在后台运行的，如果这时候关机，就有可能造成数据库出错。

好了，我们继续。

接下来，是把你保存的存档，导入到你刚搭好的mysql数据库中。

同样的mysql-front，同样的位置，但是登录界面我们就不是选择192.168.200.131了，如果你不知道本机的ip是多少，我建议你选择localhost。账号密码同上。

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/C55C4FFEB9C149DA8EEF933892FE305F/278)

和之前类似的动作，不过这次不是右键-导出了，而是右键-导入。

一个个儿子慢慢导入，千万别手抖弄错了。

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/EF04F1F628EF4180961B9F5B0CCA4B88/292)

好了，经过艰辛的过程，你终于把存档换了个新家。

别急，后面还没完。

记得之前说过的吗？这个百度来的免费数据库有后门。

实际上，它内置了一个85级的角色；这不算什么，但它还开了一个管理员账号，可以随时充钱进去的那种。

正常你玩单机版的话也不用怕，但可能你有强迫症，怎么看都觉得不爽，那么还是删了吧。

点击左下角的“用户”，正常里面只有3个

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/0CFCB34885DB427AB73C5C37206C8F66/298)

cash是游戏商城的默认充值账号；game和root都是正常账号。

如果你这里多于3个，把多的那个删除掉就好了。

好了，做完这一切就全OK了……那是做梦呢啊。

你把游戏存档放到本机了，但你没告诉过你的游戏啊，它不知道啊，它还以为你的存档放在虚拟机里啊。

我们得告诉虚拟机，我把存档位置改了，以后你再找存档，到我的本机里找。

但这就涉及到一个问题了：我的本机在哪里？

**二，更改IP指向**

本机的“位置”，也就是IP地址。

要改动这东西可就有点麻烦了，不过你今天运气好，我都给你整理好了。你只需要照着做就行了。

首先**把上面的软件该关了都关了**。记得，phpstudy那里要点“停止”才算关闭。

**1，更改你的路由器地址。**

很多教程里都没说这一点，你跑不起来游戏是因为你的路由器地址不对。

话又说过来了，既然你都看这个教程了，说明你的游戏能跑起来，也就是改过路由器ip了是吧？

不管你改没改过，照着做就是了。

这里就没图了，因为不同的路由器不一样啊。

输入你路由器的ip，输入你路由器的密码，在打开的页面找到有LAN字样的地址，再在这个界面下找到IP地址，改成192.168.200.1

保存退出。

**2，更改虚拟网卡地址**

打开VB，选中你的虚拟机，右键-设置-网络

如图，改成“仅主机（HOST-ONLY）”

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/98A12CCDD4B1411AA9ACAD82EB3BD714/327)

然后更改适配器，具体位置（以WIN7为例），右下角，打开网络和共享中心

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/611E4E8E430340009CB16EFBB9A5A72F/335)

更改适配器设置

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/69D1C88768594D2BA6B8BEDA3502DF3A/659)

正常在这个界面里，我们至少能看到2个图标。

注意了啊，“本地连接”，指的是你机器的网卡；

VirtualBox Host-Only Network，是你安装的VirtualBox，所提供的，也就是我们通常说的“虚拟网卡”；

如果你是笔记本，可能后面还跟着几个无线网络，有几个网卡就有几个图标，不过这不是本文要开展讨论的。

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/559D9273E9CA46D49C7CC9D8267E0EE6/333)

虚拟网卡是什么呢？

这么说吧，正常情况下，一个网卡只能给你分配一个本地的IP地址；但我们要用虚拟机啊，虚拟机可以看作一个单独的电脑，你说它是不是也得有网卡？也有单独的IP地址？

所以，软件就给你安装一个虚拟网卡，这样它就能多给你的电脑划几个IP用用；然后虚拟机就从这个过程中，自己也弄了一个ip。

具体分配ip地址非常复杂，反正我自己也没弄明白原理，但我知道怎么能弄的这玩意跑起来，照着图来做就行了：

首先，本地连接，右键-属性-协议版本4，

**这里全都要自动分配**

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/10E6C123D9E44AABB826EE86C1E20BA8/673)

然后，VirtualBox Host-Only Network，右键-属性-协议版本4，照着图填

高级-添加-照着图填

注意，**默认网关一定要留白！留白！**

因为通过虚拟网卡，我们可以让你的电脑多几个IP；但网关是没法变多的，这里留白，就和本地连接使用同样的设置了。

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/ABDC03FE0208415DA056B3A1341D3E7B/374)

高级TCP/IP设置那里，你可以随意增加想要的ip，写几个你的电脑就多几个ip地址。

这里我增加了三个：

192.168.1.2

192.168.200.160

192.168.1.160

可能有人问了，为什么要这么多……因为用虚拟机很烦的一点是，你必须和你的服务器处于同一“号段”上。很多网上提供的服务端，默认地址都是192.168.200.131。所以你必须有一个处于200“号段”的ip地址才行。

另外就是，游戏过程中你可能会需要运行GM工具。你要输入的ip是127.0.0.1,而有的GM工具是不能改成这个ip的，所以我们只好手动给电脑加上几个ip。

好了，这样你的ip地址就配置完成了，如果运行不起来，你可以在cmd窗口中键入ipconfig来看看，出现的数字是不是和你刚才输入的一样

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/3F47F72199EB4B468D9DBE93550DE03D/676)

不行的话就拔路由器的网线，重启电脑，解决90%的问题。

现在，加上127.0.0.1和localhost，你可以骄傲的宣布你就是传说中有六个IP的男人/女人了，厉害不厉害，霸气不霸气？

整个过程中最难的部分你已经迈过去了，接下来就是告诉你的服务端，我是个有六个IP的男/女人！

**三，告知服务器你已更改IP地址**

运行服务端，输入好密码；

运行phpstudy，点击启动；然后打开mysql-front

现在，你就是两个数据库同时运行的男人/女人了，我们要做的，就是把所有转给服务器的数据，都牵给你的本机数据库。

所以，窗口里我们选择服务端地址192.168.200.131

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/EC982D20963845EDB8F0650FB53E06E8/438)

看到没有，在d_taiwan这个儿子下面，你还有很多孙子

一个叫做db_connect的孙子，正好它是掌管着连接的（要点一下上方的‘数据浏览器’），右面很多写着192.168.200.131，我们得想个办法把他们全部换成你的本机地址

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/A189ACEBE99A4A91974537AC70384A06/441)

可能有人说了，哎呀这么多，得改到猴年马月去啊？

你运气不错，正好mysql-front有这个功能。

菜单栏，其他-替换

有点卡，稍微等等，然后在界面里选择你的孙子db_connect

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/6029665F8B2C48509A653292245CE745/456)

现在想起来你是有六个IP了的男人/女人了吧？这里就需要你贡献出你的200号段

点击运行，很快就改好了。

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/F424E59DD8CD41FB8BB370F4C62E1039/458)

先别忙，d_taiwan这个儿子还给你生了个孙子，叫做geo_allow

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/006569B7CCE84E70B6E1953F0FD64292/470)

（点开数据浏览器）保证这个孙子不会再给你生出什么重孙子，其他的都删了，只留下一行星号

然后干啥？

你想啊，服务端把数据都传给你的本机了，你的本机是不是也得表示表示？

万一你的本机想不开，把数据又传给服务端了，你说他俩踢皮球呢？

当然得全保存住啊！

打开mysql-front的界面，这次我们选择localhost，

同样是d_taiwan儿子，db_connect孙子，IP一样要改成192.168.200.160

但是，geo_allow这里，别瞎弄了啊，

万一这里给你弄没了，可真就断子绝孙了。

照图填。

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/753737F4E070484CA398DF91933357D7/485)

**四，快速备份存档**

如果你担心存档丢失；

或者想把存档发给小伙伴玩；

你总不能每次都用mqsql-front每个儿子都去备份吧。

只要你确定数据库并没有坏，那么就能用Navicat for MySQL进行批量备份。

填写账号密码的过程就不说了，

计划-新建批处理

双击的顺序如图所示

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/B89352A91F0E45FF8891E49CB771D572/627)

备份的过程需要花费一点点时间，最终存档也不过五六十兆，比起拷贝整个数据库一两个G，这个要小太多了。

存档位置在 我的文档\Navicat\MySQL\servers下

需要注意的是，要看最后备份是否成功，若是有问题的话会有一行字

 Finished - Unsuccessfully

这说明出问题了，有时候可能眼花看错了。前面会有大量的“err”，如果你没看到，那这个损失你就得自己弥补了。

**五，利用快照功能快速瘦身**

**经过上面的演练，你已经更改好了服务端。**

一些需要修改ip的地方，输入127.0.0.1就好，例如GM工具，又或者注册账号的地方。

​    ![0](https://note.youdao.com/yws/public/resource/56087a0ee4c92847b2b8e32b3a7379a8/xmlnote/F02AEC7F4A2B418AA2EC086755E4E2B2/619)

每次运行游戏，打开phpstudy，运行；再打开VB，启动服务端；最后启动游戏客户端。

关闭游戏是反过来的，先关游戏，再关vb，最后关phpstudy（别忘了点停止）

这就是传说中的“双库服务端”。

双库的好处，不仅仅是备份游戏存档，虚拟机软件一般都有一个功能，叫做“快照”。

快照的原理是，把你当前的服务器改动，做一个隔断；以后任何改动都放到其他地方。一旦有一天你想把后面的改动都去除，直接点击“恢复快照”，那么立刻就会回到你做隔断那天。

通过这个原理，我们可以快速的搭建一个全新的服务端。

例如我今天玩的是茶叶蛋大大的70级服务端，只要在第一次启动服务端的时候，做一个快照；那么等你玩腻茶叶蛋了，想换成斩龙，那你就可以立刻恢复这个快照，茶叶蛋立刻就被删除，恢复到了服务器最开始的时候。

你就可以往里面安装新的版本了。

干净利落，整个过程不超过5分钟。因为你的存档放在本机里，不用担心角色丢失，实乃小玩家硬盘福音。

（新游戏别忘了改d_taiwan和孙子db_connect）
